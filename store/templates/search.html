{% extends 'base.html' %}
{% block title %} Search Results {% endblock title %}
{% block content %}

{% load cart %}
{% load custom_filter %}
<!-- body -->
<div class="container-fluid container-layout mt-4">
	<div class="row">
		<!-- filter sidebar -->
		<div class="col-lg-2 d-none d-lg-block">
			<div class="sticky-top" style="top: 110px;">
				<h6 class="font-weight-700 text-uppercase mb-4" style="letter-spacing: 1px; font-size: 14px;">Navigation
				</h6>

				<p class="small font-weight-700 text-muted text-uppercase mb-3" style="letter-spacing: 0.5px;">
					Categories</p>
				<div class="mb-4 d-flex flex-column">
					<a href="{% url 'store' %}" class="filter-item-luxe">
						<i class="fas fa-th-large mr-2"></i> All Products
					</a>
					{% for category in categories %}
					<a href="{% url 'store' %}?category={{category.id}}" class="filter-item-luxe">
						<i class="fas fa-chevron-right mr-2 small"></i> {{category.name}}
					</a>
					{% endfor %}
				</div>
				<div class="p-3 rounded bg-light mt-5" style="border: 1px dashed #d4d5d9;">
					<p class="small font-weight-700 mb-2 mt-0">Search Tip</p>
					<p class="x-small text-muted mb-0">Try searching for styles, categories, or specific products for
						better results.</p>
				</div>
			</div>
		</div>

		<!-- Products Grid -->
		<div id='products' class="col-lg-10 col-md-12">
			<div class="mb-5">
				<h4 class="font-weight-700">Search Results for "<span class="text-pink">{{query}}</span>"</h4>
				<p class="text-muted small">We found {{products|length}} items matching your search</p>
			</div>

			<div class="row">
				{% if products %}
				{% for product in products %}
				<div class="col-6 col-md-4 col-lg-3 px-2 mb-4" id={{product.id}}>
					<div class="card h-100 border-0 shadow-sm hover-shadow transition-all">
						<a href="{% url 'product_detail' product.id %}" class="overflow-hidden d-block"
							style="height: 300px;">
							<img class="card-img-top h-100" src="{{product.image.url}}" alt="{{product.name}}"
								style="object-fit: contain;">
						</a>
						<div class="card-body d-flex flex-column p-3">
							<p class="card-title text-uppercase font-weight-bold mb-1 text-dark"
								style="font-size: 0.9rem;">{{product.name}}</p>
							<p class="card-text description-truncate text-muted small mb-2">{{product.description}}</p>
							<div class="mt-auto">
								<div class="d-flex align-items-center mb-3">
									<span
										class="price-text font-weight-bold text-dark">{{product.price|currency}}</span>
								</div>

								{% if product|is_in_cart:request.session.cart %}
								<div class="d-flex align-items-center justify-content-between p-1 border rounded-pill mb-0"
									style="border-color: var(--primary) !important;">
									<form action="/#{{product.id}}" method="post" class="mb-0">
										{% csrf_token %}
										<input hidden type="text" name='product' value='{{product.id}}'>
										<input hidden type="text" name='remove' value='True'>
										<button type="submit" class="btn btn-sm text-pink font-weight-700"
											style="width: 30px;">-</button>
									</form>
									<span
										class="small font-weight-700 text-pink">{{product|cart_quantity:request.session.cart}}</span>
									<form action="/#{{product.id}}" method="post" class="mb-0">
										{% csrf_token %}
										<input hidden type="text" name='product' value='{{product.id}}'>
										<button type="submit" class="btn btn-sm text-pink font-weight-700"
											style="width: 30px;">+</button>
									</form>
								</div>
								{% else %}
								<form action="/#{{product.id}}" method="POST" class="mb-0">
									{% csrf_token %}
									<input hidden type="text" name='product' value='{{product.id}}'>
									<button type="submit" class="btn-myntra-primary py-2 w-100 shadow-sm"
										style="font-size: 12px; border-radius: 50px;">ADD TO BAG</button>
								</form>
								{% endif %}
							</div>
						</div>
					</div>
				</div>
				{% endfor %}
				{% else %}
				<div class="col-12 text-center py-5">
					<img src="https://static-assets-web.flixcart.com/fk-p-linchpin-web/fk-cp-zion/img/error-no-search-results_2353c5.png"
						style="width: 250px; opacity: 0.6;" class="mb-4">
					<h4 class="font-weight-700">No results found</h4>
					<p class="text-muted mb-4">We couldn't find anything matching your search. Try different keywords or
						check spelling.</p>
					<a href="{% url 'homepage' %}" class="btn-myntra-primary d-inline-block px-5 py-3"
						style="width:auto; border-radius: 50px;">CONTINUE SHOPPING</a>
				</div>
				{% endif %}
			</div>
		</div>
	</div>
</div>

<style>
	.filter-item-luxe {
		color: var(--dark);
		padding: 10px 0;
		font-size: 14px;
		font-weight: 500;
		text-decoration: none !important;
		transition: var(--transition);
		border-bottom: 1px solid transparent;
	}

	.filter-item-luxe:hover {
		color: var(--primary);
		padding-left: 5px;
	}

	.filter-item-luxe.active {
		color: var(--primary);
		font-weight: 700;
	}

	.hover-shadow:hover {
		box-shadow: 0 .5rem 1rem rgba(0, 0, 0, .15) !important;
		transform: translateY(-2px);
	}

	.transition-all {
		transition: all 0.3s ease;
	}

	.x-small {
		font-size: 11px;
	}
</style>

{% endblock %}