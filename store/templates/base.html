{% load cart %}
{% load static %}
<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css">
  <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.4/css/all.css">
  <link rel="icon" type="image/png" href="{% static 'images/luxe_logo.png' %}">

  <title>Luxe | Premium Shopping</title>

  <style>
    :root {
      --primary: #ff3f6c;
      --primary-hover: #ff527b;
      --accent: #FFE135;
      /* Banana Accent */
      --dark: #282c3f;
      --gray: #94969f;
      --light-gray: #f5f5f6;
      --glass: rgba(255, 255, 255, 0.95);
      /* Increased opacity for better read */
      --shadow-sm: 0 2px 8px rgba(0, 0, 0, 0.06);
      --shadow-md: 0 10px 30px rgba(0, 0, 0, 0.08);
      --transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
    }

    body {
      font-family: 'Outfit', sans-serif;
      background-color: #fff;
      color: var(--dark);
      padding-top: 80px;
      overflow-x: hidden;
      font-size: 16px;
      /* Increased font size */
    }

    /* Glassmorphism Navbar */
    nav.navbar {
      background: var(--glass) !important;
      backdrop-filter: blur(15px);
      -webkit-backdrop-filter: blur(15px);
      border-bottom: 1px solid rgba(255, 255, 255, 0.3);
      box-shadow: var(--shadow-sm);
      min-height: 80px;
      padding: 0;
      transition: var(--transition);
      z-index: 9999 !important;
      /* Force top layer */
    }

    .navbar-collapse {
      z-index: 10000;
      position: relative;
    }

    .navbar-brand {
      font-weight: 700;
      font-size: 1.8rem;
      /* Larger Brand */
      color: var(--dark) !important;
      letter-spacing: -0.5px;
      display: flex;
      align-items: center;
      position: relative;
      z-index: 10001;
      /* Brand clickable */
    }

    .navbar-brand img {
      transition: transform 0.3s ease;
      background: var(--glass) !important;
      padding: 5px;
      border-radius: 4px;
    }

    /* .navbar-brand:hover img removed */

    .nav-link {
      color: var(--dark) !important;
      font-weight: 600;
      font-size: 15px;
      /* Larger nav links */
      text-transform: uppercase;
      letter-spacing: 0.8px;
      padding: 10px 18px !important;
      position: relative;
      transition: var(--transition);
      cursor: pointer;
      /* Ensure pointer */
    }

    @media (min-width: 992px) {
      .nav-link {
        padding: 30px 20px !important;
      }

      .nav-link::after {
        content: '';
        position: absolute;
        bottom: 0;
        left: 50%;
        width: 0;
        height: 4px;
        /* Thicker active line */
        background: var(--primary);
        transition: var(--transition);
        transform: translateX(-50%);
      }

      .nav-link:hover::after {
        width: 100%;
      }
    }

    .nav-link:hover {
      color: var(--primary) !important;
    }

    .search-container {
      background: var(--light-gray);
      border-radius: 8px;
      flex-grow: 1;
      max-width: 450px;
      margin: 10px 25px;
      display: flex;
      align-items: center;
      border: 1px solid transparent;
      transition: var(--transition);
    }

    .search-container:focus-within {
      background: #fff;
      border-color: #eaeaec;
      box-shadow: var(--shadow-sm);
    }

    .search-input {
      background: transparent;
      border: none;
      padding: 12px 15px;
      width: 100%;
      font-size: 15px;
      color: var(--dark);
      outline: none;
    }

    .nav-icons {
      display: flex;
      align-items: center;
      flex-direction: row;
      /* Ensure row layout */
    }

    .nav-icon-item {
      display: flex;
      /* Flexbox for alignment */
      align-items: center;
      /* Center vertically */
      margin-left: 25px;
      color: var(--dark);
      text-decoration: none !important;
      transition: var(--transition);
      position: relative;
    }

    .nav-icon-item:hover {
      color: var(--primary);
      transform: translateY(-2px);
    }

    .nav-icon-item i {
      font-size: 20px;
      display: block;
      margin-bottom: 0;
      /* Remove bottom margin */
      margin-right: 8px;
      /* Add right margin */
    }

    .nav-icon-item span {
      font-size: 14px;
      font-weight: 700;
      text-transform: uppercase;
    }

    /* Premium Universal UI */
    .card {
      border: none;
      border-radius: 12px;
      transition: var(--transition);
      background: #fff;
      overflow: hidden;
    }

    .card:hover {
      box-shadow: var(--shadow-md);
      transform: translateY(-5px);
    }

    .card-img-top {
      height: 380px;
      /* Taller images */
      object-fit: contain;
      /* Show full image */
      background-color: #fff;
      padding: 10px;
      transition: transform 0.5s ease;
    }

    .card:hover .card-img-top {
      transform: scale(1.05);
    }

    .card-body {
      padding: 20px;
    }

    .card-title {
      font-size: 16px;
      font-weight: 700;
      margin-bottom: 6px;
      color: var(--dark);
    }

    .card-text.description-truncate {
      color: var(--gray);
      font-size: 14px;
      margin-bottom: 15px;
      display: -webkit-box;
      -webkit-line-clamp: 2;
      line-clamp: 2;
      /* Fixed lint error */
      -webkit-box-orient: vertical;
      overflow: hidden;
    }

    .price-text {
      font-size: 16px;
      font-weight: 700;
      color: var(--dark);
    }

    .btn-myntra-primary {
      background: linear-gradient(135deg, var(--primary), #ff648a);
      color: #fff;
      font-weight: 700;
      border-radius: 8px;
      padding: 14px 24px;
      border: none;
      width: 100%;
      font-size: 14px;
      text-transform: uppercase;
      letter-spacing: 1px;
      transition: var(--transition);
      box-shadow: 0 4px 15px rgba(255, 63, 108, 0.2);
    }

    .btn-myntra-primary:hover {
      background: linear-gradient(135deg, var(--primary-hover), var(--primary));
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(255, 63, 108, 0.3);
      color: #fff;
    }

    .badge-myntra {
      position: absolute;
      top: -6px;
      right: -10px;
      background: var(--primary);
      color: white;
      border-radius: 50px;
      font-size: 11px;
      font-weight: 700;
      min-width: 22px;
      height: 22px;
      display: flex;
      align-items: center;
      justify-content: center;
      border: 2px solid #fff;
      box-shadow: 2px 2px 5px rgba(0, 0, 0, 0.1);
    }

    /* Container Spacing */
    .container-layout {
      max-width: 1600px;
      /* Wider layout */
      padding: 0 50px;
    }

    @media (max-width: 768px) {
      .container-layout {
        padding: 0 20px;
      }

      body {
        padding-top: 140px;
      }
    }

    /* Scrollbar Style */
    ::-webkit-scrollbar {
      width: 8px;
    }

    ::-webkit-scrollbar-track {
      background: var(--light-gray);
    }

    ::-webkit-scrollbar-thumb {
      background: var(--gray);
      border-radius: 10px;
    }

    ::-webkit-scrollbar-thumb:hover {
      background: var(--dark);
    }
  </style>
</head>

<body>
  {% load cart %}
  {% load custom_filter %}
  <nav class="navbar navbar-expand-lg fixed-top">
    <div class="container-fluid container-layout">
      <a class="navbar-brand" href="/">
        <img src="{% static 'images/luxe_logo.png' %}" style="width: 120px; height: auto;" alt="Luxe">
      </a>

      <button class="navbar-toggler p-0 border-0" type="button" data-toggle="collapse"
        data-target="#navbarSupportedContent">
        <div class="luxe-burger">
          <span style="display:block; width:25px; height:2px; background:var(--dark); margin:5px 0;"></span>
          <span style="display:block; width:15px; height:2px; background:var(--primary); margin:5px 0;"></span>
          <span style="display:block; width:25px; height:2px; background:var(--dark); margin:5px 0;"></span>
        </div>
      </button>

      <div class="collapse navbar-collapse" id="navbarSupportedContent">
        <ul class="navbar-nav mr-auto ml-lg-4">
          <li class="nav-item"><a class="nav-link" href="/">Home</a></li>
          <li class="nav-item"><a class="nav-link" href="/store?category=2">Men's</a></li>
          <li class="nav-item"><a class="nav-link" href="/store?category=1">Women's</a></li>
          <li class="nav-item"><a class="nav-link" href="/store?category=3">Kids</a></li>

          <!-- MORE Dropdown -->
          <li class="nav-item dropdown">
            <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown"
              aria-haspopup="true" aria-expanded="false">
              More Categories
            </a>
            <div class="dropdown-menu border-0 shadow-lg mt-3" aria-labelledby="navbarDropdown"
              style="border-radius: 12px; min-width: 200px;">
              {% get_categories as categories %}
              <a class="dropdown-item py-2 small font-weight-600" href="/store"><i class="fas fa-th mr-2"></i> All
                Products</a>
              <div class="dropdown-divider"></div>
              {% for category in categories %}
              <a class="dropdown-item py-2 small font-weight-600"
                href="/store?category={{category.id}}">{{category.name}}</a>
              {% endfor %}
            </div>
          </li>
        </ul>

        <div class="search-container">
          <form action="/search" method="GET" class="w-100 d-flex align-items-center mb-0">
            <i class="fas fa-search text-muted ml-3" style="font-size: 16px;"></i>
            <input type="text" name="query" class="search-input" placeholder="Search for products, categories..."
              title="Search products">
          </form>
        </div>

        <div class="nav-icons ml-lg-4">
          {% if request.session.customer %}
          <div class="dropdown">
            <a class="nav-icon-item dropdown-toggle" href="#" data-toggle="dropdown" aria-haspopup="true"
              aria-expanded="false">
              <i class="far fa-user"></i>
              <span>Profile</span>
            </a>
            <div class="dropdown-menu dropdown-menu-right mt-lg-3 border-0 shadow-lg p-0 overflow-hidden"
              style="border-radius: 12px; min-width: 220px;">
              <div class="px-4 py-4 bg-dark text-white text-center">
                <div class="mb-2" style="font-size: 24px;"><i class="fas fa-user-circle"></i></div>
                <p class="mb-0 font-weight-700 small" style="font-size: 16px;">{{request.session.email}}</p>
              </div>
              <div class="p-2">
                <a class="dropdown-item py-3 px-3 font-weight-700 rounded" href="/profile" style="font-size: 15px;"><i
                    class="fas fa-cog mr-2"></i> Settings</a>
                <a class="dropdown-item py-3 px-3 font-weight-700 rounded" href="/orders" style="font-size: 15px;"><i
                    class="fas fa-history mr-2"></i> Orders</a>
                <div class="dropdown-divider"></div>
                <a class="dropdown-item py-3 px-3 font-weight-700 rounded text-danger" href="/logout"
                  style="font-size: 15px;"><i class="fas fa-power-off mr-2"></i> Logout</a>
              </div>
            </div>
          </div>
          {% else %}
          <a class="nav-icon-item" href="/login">
            <i class="far fa-user"></i>
            <span>Log In</span>
          </a>
          {% endif %}

          <a class="nav-icon-item position-relative" href="/cart">
            <i class="fas fa-shopping-bag"></i>
            <span>My Cart</span>
            {% if request.session.cart %}
            <span class="badge-myntra">{{request.session.cart|cart_item_count}}</span>
            {% endif %}
          </a>
        </div>
      </div>
    </div>
  </nav>

  <main>
    {% block content %}{% endblock %}
  </main>

  <style>
    .dropdown-item:hover {
      background-color: var(--light-gray);
      color: var(--primary);
    }

    .text-pink {
      color: var(--primary) !important;
    }

    main {
      min-height: 75vh;
    }

    /* Global Alerts */
    .alert {
      border-radius: 10px;
      border: none;
      padding: 15px 20px;
      font-weight: 500;
      box-shadow: var(--shadow-sm);
    }

    .alert-success {
      background: #e6fffb;
      color: #00b894;
      border-left: 4px solid #00b894;
    }

    .alert-danger {
      background: #fff5f5;
      color: var(--primary);
      border-left: 4px solid var(--primary);
    }
  </style>

  <!-- Luxe Footer -->
  <footer class="mt-5 py-5" style="background: #1a1a1a; color: #fff;">
    <div class="container-fluid container-layout">
      <div class="row justify-content-center text-center">
        <div class="col-12">
          <ul class="list-inline mb-0">
            <li class="list-inline-item mx-3 mb-2"><a href="{% url 'about' %}"
                class="text-gray small font-weight-600 text-uppercase"
                style="text-decoration: none; color: #aaa;">About</a></li>
            <li class="list-inline-item mx-3 mb-2"><a href="{% url 'terms' %}"
                class="text-gray small font-weight-600 text-uppercase" style="text-decoration: none; color: #aaa;">Terms
                & Conditions</a></li>
            <li class="list-inline-item mx-3 mb-2"><a href="{% url 'privacy' %}"
                class="text-gray small font-weight-600 text-uppercase"
                style="text-decoration: none; color: #aaa;">Privacy Policy</a></li>
            <li class="list-inline-item mx-3 mb-2"><a href="{% url 'contact' %}"
                class="text-gray small font-weight-600 text-uppercase"
                style="text-decoration: none; color: #aaa;">Contact Us</a></li>
            <li class="list-inline-item mx-3 mb-2"><a href="{% url 'licence' %}"
                class="text-gray small font-weight-600 text-uppercase"
                style="text-decoration: none; color: #aaa;">Licence</a></li>
          </ul>
          <div class="mt-4 pt-4 border-top" style="border-color: #333 !important;">
            <p class="small mb-0" style="color: #666;">Luxe &copy; 2026 All Rights Reserved.</p>
          </div>
        </div>
      </div>
    </div>
  </footer>

  <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"></script>

  <script>
    $(document).ready(function () {
      var currentPath = window.location.pathname + window.location.search;
      $('.nav-link').each(function () {
        // Improve active link logic to handle query params loosely or exact path
        if ($(this).attr('href') === currentPath || (currentPath === '/' && $(this).attr('href') === '/')) {
          $(this).addClass('active-link');
        }
      });

      const badge = $('.badge-myntra');
      if (badge.length > 0 && parseInt(badge.text()) > 0) {
        badge.addClass('pulse-badge');
      }
    });
  </script>

  <style>
    .active-link {
      color: var(--primary) !important;
      font-weight: 700;
    }

    @media (min-width: 992px) {
      .active-link::after {
        width: 100% !important;
      }
    }

    .pulse-badge {
      animation: pulse 2.5s infinite ease-in-out;
    }

    @keyframes pulse {
      0% {
        transform: scale(1);
        box-shadow: 0 0 0 0 rgba(255, 63, 108, 0.4);
      }

      70% {
        transform: scale(1.15);
        box-shadow: 0 0 0 10px rgba(255, 63, 108, 0);
      }

      100% {
        transform: scale(1);
        box-shadow: 0 0 0 0 rgba(255, 63, 108, 0);
      }
    }
  </style>
</body>

</html>