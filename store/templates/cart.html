{% extends 'base.html' %}
{% load cart %}
{% load custom_filter %}

{% block content %}
<div class="container py-5 mt-5">
  <div class="row">
    <div class="col-lg-8">
      <div class="card p-0 border shadow-none mb-4" style="border-radius: 12px;">
        <div class="p-4 border-bottom d-flex justify-content-between align-items-center"
          style="background: var(--light-gray);">
          <h5 class="font-weight-700 mb-0" style="letter-spacing: -0.5px;">My Bag <span
              class="text-muted small">({{products|length}} Items)</span></h5>
        </div>
        <div class="table-responsive">
          <table class="table mb-0">
            <tbody>
              {% for product in products %}
              <tr class="border-bottom">
                <td width="160" class="p-4">
                  <img style="height: 140px; width: 100px; object-fit: cover; border-radius: 10px;"
                    src="{{product.image.url}}" alt="" class="shadow-sm">
                </td>
                <td class="p-4">
                  <p class="font-weight-700 mb-1 text-uppercase" style="font-size: 15px;">{{product.name}}</p>
                  <p class="text-muted small mb-3">{{product.category.name}}</p>
                  <div class="d-flex align-items-center mb-3">
                    <span class="font-weight-700 mr-2"
                      style="font-size: 18px; color: var(--dark);">{{product.price|currency}}</span>
                  </div>
                  <div class="d-flex align-items-center">
                    <div class="d-flex align-items-center border rounded-pill px-2 py-1"
                      style="border-color: #eaeaec !important;">
                      <form action="/#{{product.id}}" method="post" class="mb-0">
                        {% csrf_token %}
                        <input hidden type="text" name='product' value='{{product.id}}'>
                        <input hidden type="text" name='remove' value='True'>
                        <input hidden type="text" name='return_url' value='cart'>
                        <button type="submit" class="btn btn-link text-dark p-0"
                          style="width: 28px; height: 28px; text-decoration: none; font-size: 18px;">-</button>
                      </form>
                      <span class="px-3 small font-weight-700">{{product|cart_quantity:request.session.cart}}</span>
                      <form action="/#{{product.id}}" method="post" class="mb-0">
                        {% csrf_token %}
                        <input hidden type="text" name='product' value='{{product.id}}'>
                        <input hidden type="text" name='return_url' value='cart'>
                        <button type="submit" class="btn btn-link text-dark p-0"
                          style="width: 28px; height: 28px; text-decoration: none; font-size: 18px;">+</button>
                      </form>
                    </div>
                  </div>
                </td>
                <td class="p-4 text-right">
                  <p class="font-weight-700 mb-4" style="font-size: 18px;">
                    {{product|price_total:request.session.cart|currency}}</p>
                  <form action="/#{{product.id}}" method="post">
                    {% csrf_token %}
                    <input hidden type="text" name='product' value='{{product.id}}'>
                    <input hidden type="text" name='clear' value='True'>
                    <input hidden type="text" name='return_url' value='cart'>
                    <button type="submit"
                      class="btn text-muted p-0 border-0 bg-transparent small font-weight-700 hover-pink">
                      <i class="far fa-trash-alt mr-1"></i> REMOVE
                    </button>
                  </form>
                </td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <div class="col-lg-4">
      <div class="card p-4 border shadow-none sticky-top" style="top: 100px; border-radius: 12px;">
        <p class="font-weight-700 small text-muted text-uppercase mb-4" style="letter-spacing: 1px;">Order Summary</p>
        <div class="d-flex justify-content-between mb-3">
          <span class="text-muted small">Total MRP</span>
          <span class="small font-weight-600">{{products|total_cart_price:request.session.cart|currency}}</span>
        </div>
        <div class="d-flex justify-content-between mb-3">
          <span class="text-muted small">Convenience Fee</span>
          <span class="text-success small font-weight-600">FREE</span>
        </div>
        <hr style="border-top: 1px dashed #d4d5d9;">
        <div class="d-flex justify-content-between mb-4">
          <span class="font-weight-700" style="font-size: 18px;">Total Amount</span>
          <span class="font-weight-700"
            style="font-size: 18px; color: var(--primary);">{{products|total_cart_price:request.session.cart|currency}}</span>
        </div>

        <button data-toggle="modal" data-target="#exampleModal" class="btn-myntra-primary py-3">PLACE ORDER</button>
      </div>
    </div>
  </div>
</div>

<!-- Modal -->
<div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered" role="document">
    <div class="modal-content border-0 shadow-lg" style="border-radius: 15px;">
      <div class="modal-header border-bottom-0 p-4">
        <h5 class="font-weight-700 mb-0">Shipping Information</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body p-4">
        <form action="/check-out" method="POST">
          {% csrf_token %}
          <div class="form-group mb-3">
            <label class="small font-weight-700 text-muted text-uppercase mb-1">Name</label>
            <input type="text" name="name" class="form-control" placeholder="Enter Full Name" required
              style="border-radius: 8px;">
          </div>
          <div class="form-group mb-3">
            <label class="small font-weight-700 text-muted text-uppercase mb-1">House No</label>
            <input type="text" name="house_no" class="form-control" placeholder="House No, Building Name" required
              style="border-radius: 8px;">
          </div>
          <div class="form-group mb-3">
            <label class="small font-weight-700 text-muted text-uppercase mb-1">Area / Street</label>
            <input type="text" name="area" class="form-control" placeholder="Area, Colony, Street" required
              style="border-radius: 8px;">
          </div>
          <div class="form-group mb-3">
            <label class="small font-weight-700 text-muted text-uppercase mb-1">Landmark</label>
            <input type="text" name="landmark" class="form-control" placeholder="Near by Landmark" required
              style="border-radius: 8px;">
          </div>
          <div class="row">
            <div class="col-md-6 form-group mb-3">
              <label class="small font-weight-700 text-muted text-uppercase mb-1">City</label>
              <input type="text" name="city" class="form-control" placeholder="City" required
                style="border-radius: 8px;">
            </div>
            <div class="col-md-6 form-group mb-3">
              <label class="small font-weight-700 text-muted text-uppercase mb-1">Pincode</label>
              <input type="text" name="pincode" class="form-control" placeholder="Pincode" required
                style="border-radius: 8px;">
            </div>
          </div>
          <div class="form-group mb-4">
            <label class="small font-weight-700 text-muted text-uppercase mb-1">Contact No</label>
            <input type="text" name="phone" class="form-control" placeholder="10-digit mobile number" required
              style="border-radius: 8px;">
          </div>
          <input type="submit" class="btn-myntra-primary py-3 w-100" value="CONFIRM ORDER" style="border-radius: 10px;">
        </form>
      </div>
    </div>
  </div>
</div>

<style>
  .hover-pink:hover {
    color: var(--primary) !important;
  }

  .table td {
    vertical-align: middle;
  }
</style>

{% endblock %}