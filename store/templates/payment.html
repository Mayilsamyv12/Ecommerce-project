{% extends 'base.html' %}
{% load custom_filter %}

{% block content %}
<div class="container py-5 mt-5">
    <div class="row justify-content-center">
        <div class="col-lg-8">
            <h4 class="font-weight-700 mb-4 text-center">Choose Payment Method</h4>

            <div class="card border shadow-sm rounded-lg overflow-hidden">
                <div class="card-body p-0">
                    <div class="accordion" id="accordionPayment">

                        <!-- UPI Payment -->
                        <div class="card border-0 mb-0">
                            <div class="card-header bg-white border-bottom-0 p-3" id="headingOne">
                                <h2 class="mb-0">
                                    <button
                                        class="btn btn-link btn-block text-left text-dark font-weight-700 text-decoration-none d-flex align-items-center"
                                        type="button" data-toggle="collapse" data-target="#collapseOne"
                                        aria-expanded="true" aria-controls="collapseOne">
                                        <i class="fas fa-mobile-alt mr-3 text-primary" style="font-size: 20px;"></i> UPI
                                        (Google Pay, PhonePe, Paytm)
                                    </button>
                                </h2>
                            </div>
                            <div id="collapseOne" class="collapse show" aria-labelledby="headingOne"
                                data-parent="#accordionPayment">
                                <div class="card-body p-4 bg-light">
                                    <div class="d-flex align-items-center mb-3 p-3 bg-white border shadow-sm"
                                        style="border-radius: 8px;">
                                        <div class="mr-3">
                                            <i class="fas fa-store-alt text-primary" style="font-size: 24px;"></i>
                                        </div>
                                        <div>
                                            <small class="text-muted d-block font-weight-600 text-uppercase"
                                                style="font-size: 11px;">Paying to Merchant</small>
                                            <span class="font-weight-700 text-dark"
                                                style="font-size: 16px;">msmayil20@oksbi</span>
                                        </div>
                                    </div>
                                    <p class="text-muted small mb-3">Enter your UPI ID correctly. You will receive a
                                        payment request from <strong>msmayil20@oksbi</strong>.</p>
                                    <form action="/place-order" method="POST" id="upiForm">
                                        {% csrf_token %}
                                        <input type="hidden" name="payment_method" value="UPI">
                                        <div class="form-group">
                                            <input type="text" id="upi_id_input" name="upi_id" class="form-control"
                                                placeholder="e.g. yourname@upi" required style="border-radius: 8px;">
                                        </div>
                                        <button type="button" onclick="verifyUPI()"
                                            class="btn-myntra-primary py-3 w-100" style="border-radius: 10px;">VERIFY &
                                            PLACE ORDER</button>
                                    </form>
                                    <div id="upiNotification" class="alert alert-success mt-3 d-none"
                                        style="border-radius: 10px;">
                                        <small><i class="fas fa-check-circle mr-1"></i> Request sent from
                                            <strong>msmayil20@oksbi</strong>! Check your app to approve.</small>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Credit/Debit Card -->
                        <div class="card border-0 mb-0 border-top">
                            <div class="card-header bg-white border-bottom-0 p-3" id="headingTwo">
                                <h2 class="mb-0">
                                    <button
                                        class="btn btn-link btn-block text-left text-dark font-weight-700 text-decoration-none d-flex align-items-center"
                                        type="button" data-toggle="collapse" data-target="#collapseTwo"
                                        aria-expanded="false" aria-controls="collapseTwo">
                                        <i class="far fa-credit-card mr-3 text-warning" style="font-size: 20px;"></i>
                                        Credit / Debit Card
                                    </button>
                                </h2>
                            </div>
                            <div id="collapseTwo" class="collapse" aria-labelledby="headingTwo"
                                data-parent="#accordionPayment">
                                <div class="card-body p-4 bg-light">
                                    <form action="/place-order" method="POST">
                                        {% csrf_token %}
                                        <input type="hidden" name="payment_method" value="CARD">
                                        <div class="form-group">
                                            <input type="text" class="form-control mb-3" placeholder="Card Number"
                                                required style="border-radius: 8px;">
                                            <div class="row">
                                                <div class="col-6">
                                                    <input type="text" class="form-control" placeholder="MM / YY"
                                                        required style="border-radius: 8px;">
                                                </div>
                                                <div class="col-6">
                                                    <input type="text" class="form-control" placeholder="CVV" required
                                                        style="border-radius: 8px;">
                                                </div>
                                            </div>
                                            <input type="text" class="form-control mt-3" placeholder="Card Holder Name"
                                                required style="border-radius: 8px;">
                                        </div>
                                        <button type="submit" class="btn-myntra-primary py-3 w-100"
                                            style="border-radius: 10px;">PAY & PLACE ORDER</button>
                                    </form>
                                </div>
                            </div>
                        </div>

                        <!-- Cash on Delivery -->
                        <div class="card border-0 mb-0 border-top">
                            <div class="card-header bg-white border-bottom-0 p-3" id="headingThree">
                                <h2 class="mb-0">
                                    <button
                                        class="btn btn-link btn-block text-left text-dark font-weight-700 text-decoration-none d-flex align-items-center"
                                        type="button" data-toggle="collapse" data-target="#collapseThree"
                                        aria-expanded="false" aria-controls="collapseThree">
                                        <i class="fas fa-money-bill-wave mr-3 text-success"
                                            style="font-size: 20px;"></i> Cash on Delivery
                                    </button>
                                </h2>
                            </div>
                            <div id="collapseThree" class="collapse" aria-labelledby="headingThree"
                                data-parent="#accordionPayment">
                                <div class="card-body p-4 bg-light">
                                    <p class="text-muted small mb-3">Pay with cash when your order is delivered to your
                                        doorstep.</p>
                                    <form action="/place-order" method="POST">
                                        {% csrf_token %}
                                        <input type="hidden" name="payment_method" value="COD">
                                        <button type="submit" class="btn-myntra-primary py-3 w-100"
                                            style="border-radius: 10px;">PLACE ORDER</button>
                                    </form>
                                </div>
                            </div>
                        </div>

                    </div>
                </div>
                <div class="card-footer bg-white p-4">
                    <div class="d-flex justify-content-between align-items-center">
                        <span class="text-muted font-weight-600">Total Amount</span>
                        <span class="font-weight-700"
                            style="font-size: 20px; color: var(--dark);">{{total|currency}}</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    function verifyUPI() {
        const upiInput = document.getElementById('upi_id_input');
        if (!upiInput || upiInput.value.trim() === "") {
            alert("Please enter a valid UPI ID");
            return;
        }

        // Simulate Notification
        const notif = document.getElementById('upiNotification');
        notif.classList.remove('d-none');

        // Simulate delay then submit
        setTimeout(() => {
            document.getElementById('upiForm').submit();
        }, 3000);
    }
</script>

<style>
    .btn-link:focus,
    .btn-link:hover {
        text-decoration: none;
        background-color: #f8f9fa;
    }

    .card-header {
        transition: background-color 0.3s;
    }

    .card-header:hover {
        background-color: #f8f9fa !important;
    }
</style>
{% endblock %}